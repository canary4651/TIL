# statistics_12

### 데이터 분석가가 꼭 필요한 이유?

- 꼭 데이터 분석을 공부한다고 해서 데이터 분석가가 될 필요는 없다. 어디에나 쓸 수 있는 필수 역량이기 때문에.
- 액션을 잘 제시하기 어려움. 현황만 말해줌 그래서 마케팅이랑 같이 하면 좋음 → 어떻게 해야할 지를 제시

# 시계열 분석

## 시계열

- 동일한 변수의 시간에 따른 변동을 나타낸 데이터
- 예시 : 고객 수, 가격, 온도

## 주요 개념

- 자기 상관(autocorrelation): 이전의 값과 이후의 값 사이에 상관이 존재
    - 상관 : 두 변수가 얼마나 같이 움직이냐
    - 자기 상관 : 자기 자신과의 상관이 얼마나 같이 움직이냐 (상관이 1이기 때문에 시점 간의 상관과 비교함)
    - 평균 추세는 고정되어 있음
    - 자기 상관이 + 인지 - 인지 살펴보는 것도 중요
        - 기분이 - (조울증) / + (한번 좋으면 오래가고, 한번 우울하면 계속 우울하고)
    - 주별 제품 판매량
        - 자기 상관이 - (평균선을 기준으로 오르락 내리락 한다는 뜻/ 이번주에 적게 벌면 담주에 더 벌고, 이번주에 많이 벌면 담주에 적게 벌고) ex) 몸무게

        ![](Untitled-eec81436-38f4-46ff-adc0-8f8764e4e8aa.png)

    - 화학 공정의 품질 (이번 주 판매량과 다음 주 판매랑, 다다음 주 판매량 ...)
        - 기본적으로 오르락 내리락하긴 하는 데, 폭이 큼 (화학 공정은 멈출 수가 없기 때문에)
        - 자기 상관이 + (한번 올라가면 잘 떨어지지 않고, 한번 떨어지면 잘 안올라감)

        ![](Untitled-46c720d3-3f3a-41a8-b845-5aea29efde65.png)

- 추세(trend): 장기적인 추세
    - 연간 치즈 생산량
    - 장기 투자자들 (낮을 때 사서 약간씩 오르내려도 꾹 참고 오를 때 팜)
        - 자기 상관으로 돈 버는 주식투자자들(내려갈 때 샀다가 올라가면 팔고 반복)

    ![](Untitled-e6968187-3d37-4135-bde1-6bee6c9c42df.png)

- 계절성(seasonality): 주기적인 변동
    - 월별 음료 출고량
    - 긴 기간에 걸친 자기 상관 ( 큰 그래프를 보임)

    ![](Untitled-7695ad86-b2e8-4bce-afa8-c0ec16a71f6b.png)

- 정상(stationary): 시계열의 구조가 일정한 상태(normal의 뜻이 아님)
    - 자기 상관이 일정하면 정상이라고 할 수 있음
    - 상태 자체가 패턴이 일정한 거 (현실적으로 정상은 없는 데 가정하는 거 - 이 정도 기간에선 정상일 거다)
    - 근데 대부분의 시계열은 비정상임
    - 비정상 : 주가
    - 데이터 패턴이 계속 변함. 시계열 분석하기 어려움. 데이터 분석으로 돈 벌기 어려움

    ![](Untitled-908c8530-3e42-4825-8534-7cb76ec9aa17.png)

- 이상점 : 공장 화재
- 아웃라이어

![](Untitled-6561c23d-3b0b-4443-9493-f0b7181c8409.png)

### 조별 과제

- 마켓 컬리 일일 주문량 패턴 → 하루 단위의 계절성 (11시 전까지 오르다가 떨어짐)
- 서울 시 아파트 매매 가격 → 자기 상관 (-)
- 대한항공의 연간 비행기 이용 횟수 - 계절성
- 냉면 판매량 - 계절성
- 환율 → 자기 상관 (-)
- 내 학습 일지 → 자기 상관 (-)
- 수면 패턴 → 자기 상관(-)

## 자기 상관의 패턴

![](Untitled-f3f82dd1-f7a5-47e4-a595-ee348bb4a4be.png)

## ACF Auto Correlation Function

- 자기 상관 그래프
- 1시점, 2시점, 3시점, … 간격으로 상관을 구한 것

## 무작위로 움직이는 경우 ACF

- 상관이 모든 간격에서 0

![](Untitled-19478f3f-4e47-41d2-bed9-535fa679f00e.png)

## Positive한 상관이 있는 ACF

- 평균선을 넘는 그래프만 상관이 있는 거
- 점점 상관이 0이 되는 그래프

![](Untitled-c3c3a64e-7a79-42bd-a60a-f5cb9c080f10.png)

- negative한 상관 acf?
    - +와 - 영역을 오르락 내리락 함

![](Untitled-e7c10d42-c389-439c-8aeb-42d77af8e0bc.png)

## 비정상(non-stationary) 시계열의 ACF

- 떨어지는 정도가 다름

![](Untitled-4bf3aa3a-f299-4bae-8c59-c8bece365dc9.png)

## PACF (partical)

- ACF에서는 1시점 간격으로 상관이 있을 경우 2시점, 3시점 간격으로도
상관이 있는 것처럼 보임
- PACF는 순수하게 시점 간 상관만 추출한 것

## Augmented Dickey-Fuller Test

- 시계열이 정상(stationary)인지 검정
- p가 .05보다 작으면 정상

비정상을 정상으로 바꿔보는 방법 

- 바뀌는 부분 (빼주기) - 빨간 추세 선
- 안 바뀌는 부분 → 정상 (일정하게 오르락 내리락하는 선)
- 그렇지만 만약 바뀌는 부분(선)을 빼도 다른 선이 큰 폭으로 오르락 내리락하게 된다면 비정상임

## 차분 Differencing

- 시계열 데이터를 직전/직후 시점간의 차이로 바꾸는 것
- 선형적인 추세가 있으면 시계열이 비정상(non-stationary)
- 차분으로 선형적 추세를 제거

## MA 모형

- 데이터가 평균에서 벗어나지 않는다고 가정 (평균 주변에 묶여있다)
- **데이터가 평균을 따라간다**
- 평균에서 벗어난 입실론 만큼이 다음에 영향을 줌

![](Untitled-80d9e703-a516-4f1b-9e9f-26fd7b57508c.png)

![](Untitled-bdfae4cf-f00d-4602-879d-e97f9f7a28b6.png)

![](Untitled-975c1b87-b622-4d52-a410-36ccba2bc930.png)

![](Untitled-2b504a09-f211-4d9f-ba3d-84cf61499453.png)

![](Untitled-f4083a2d-0216-41ae-a0a0-a63b9b4fca1c.png)

## MA(q) 모형

- 오래 전 시점의 영향은 사라질 수 있음
- 평균에서 벗어났을 때 그 영향이 얼마나 가느냐?
- 만약 현재 시점에는 1시점 이전만 영향을 미친다면 MA(1)

    ![](Untitled-9812ab62-39ad-485a-a08d-e7d030cea6ef.png)

- 만약 1시점, 2시점 이전만 영향을 미찬다면 MA(2)
- q는 어떻게 정하는가? → ACF를 그려본다

## MA(1)

![](Untitled-b39fd52a-1141-49d4-ac69-31b5d7f19ac9.png)

## MA(2)

![](Untitled-77a85264-c59d-4b62-8885-11c41b91292c.png)

## MA 모형의 ACF와 PACF

- **ACF는 특정한 값 q에서 뚝 끊기는 형태 (평균이 얼마나 영향을 미치는 지를 acf 보면서 판단)**
- PACF는 점점 감소하는 형태

## AR 모형

- 지난달을 따라감 (ma: 평균을 따라감)
- ar(1) : 지난달에 영향을 받는 거(평균 고려 안하고)
- ar(2) : 지난달 + 지지난달에 영향을 받음
- ar이 길어질 수록 영향을 주는 달이 많아짐
- acf는 서서히 감소하는 형태
- pacf는 특정한 값 p에서 뚝 끊기는 형태 (지난달이 얼마나 영향을 미치는 지를 pacf 보면서 판단)

![](Untitled-52fb0bb4-cb46-4295-b716-b1cfaa187048.png)

![](Untitled-27ee4317-b6da-4721-b44d-6007ffc088af.png)

## MA 모형과 AR 모형의 차이

- MA 모형: 이전 시점의 오차가 영향
- AR 모형: 이전 시점의 값이 영향

## AR 모형에서 ACF의 문제

- MA(q) 모형은 q 이상의 차이가 나면 영향력이 0
- AR(p) 모형에서는 AR(1)이라도 영향이 계속 남음
- 예) 가중치가 0.8이고 한 번 100으로 올라가면
- 100 → 80 → 64 → …

## AR 모형의 ACF와 PACF

- ACF는 점점 감소하는 형태
- PACF는 특정한 값 p에서 뚝 끊기는 형태

![](Untitled-27c40a4f-5fa6-443c-86be-803907dc0196.png)

## ARMA(p, q)

- 복잡해짐 p도 알아야하고 q도 알아야 하고
- → acf, pacf 다 봐야함
- AR 모형과 MA 모형을 합친 것
- p 이전 시점까지의 값도 영향을 미치고
- q 이전 시점까지의 오차도 영향을 미치는 구조

## ARMA 모형의 ACF와 PACF

- ACF와 PACF가 모두 점점 감소하는 형태

![](Untitled-8209ba22-2cda-4f01-8298-01526e42d14a.png)

## ARIMA(p, d, q)

- ARMA(p, q) 모형에 차분 d가 통합(Integrated)된 것 (차분까지 넣은거)
- d ⇒ 차분을 몇 번 해줄 거냐
- d = 1인 경우 한 번 차분
- d = 2인 경우 두 번 차분(차분한 값을 다시 차분)

## SARIMA(p, d, q) (P, D, Q, m)

- (p자기상관, d 추세, q자기상관) - 데이터가 국소적으로 어떻게 움직이느냐
- P, D, Q, m) - 계절성 (긴 자기상관)
- 대문자 P,D,Q : 계절성을 나타냄 m : 계절이 얼마나 지속되느냐
- ARIMA 모형에 계절성(Seasonality)이 추가
- 계절성은 별도의 (P, D, Q, m)에 따라 변화
- m은 계절의 기간

## SARIMAX

- SARIMA 모형에 **외생 변수(eXogenous)**를 추가

## SARIMA 모형의 하이퍼 파라미터 선택

- 하이퍼 파라미터: p, d, q, P, D, Q, m # 7가지 숫자 정하기
- 플롯, ACF, PACF 등등을 보면서 열심히 생각한다
- 여러 가지로 바꿔가며 AIC, BIC 등을 확인한다
- 기존 데이터의 마지막 부분을 예측하여 오차를 확인한다

## Prophet

- Facebook이 발표한 시계열 데이터 분석 모형 및 라이브러리
- 정상 시계열이 아니라도 사용 가능(변화점 추정)

# 복습테스트

1. 데이터의 차원(dimension)에 대한 설명으로 옳은 것을 **모두** 고르세요.

    **데이터의 차원이란 곧 변수의 개수이다.**

    **차원이 크면 시각화도 어렵고, 이해하거나 분석하기도 어렵다.**

    **여러 개의 변수를 적은 수의 변수로 줄이는 것을 차원 축소라고 한다**

    **여러 과목의 성적을 평균 내어 평균 점수로 만드는 것도 차원 축소라고 할 수 있다**

    **차원 축소에는 PCA, NMF, 요인분석 등의 기법이 있다**

    **다차원척도법(MDS)는 점들 사이의 거리를 최대한 보존하는 방법이다**

2. 생존 함수에 대한 설명으로 옳은 것을 **모두** 고르세요

    **100%에서 시작하여 시간이 지날 수록 점점 떨어진다**

    **위험이 고객의 이탈일 경우, 생존 함수는 각 시점까지 남아있는 고객의 비율을 나타낸다**

    위험이 환자의 완치일 경우, 생존 함수는 각 시점까지 완치된 환자의 비율을 나타낸다 

    → 위험이 완치라는 말은 완치가 =죽음 이란 말,그래서 생존 함수는 아직 병이 남아있는 사람들인 거임. 

    **생존 분석에서 연구에 참여한 환자가 더이상 병원이 오지 않아서 그 이후로 언제 완치되었는지 알 수 없는 경우를 right censored 되었다고 한다**

    **카플란 마이어 추정은 right censored 된 데이터에서도 생존 함수를 추정할 수 있게 해준다**

    → 생존함수 추정하는 방법 

    **매끄러운 생존함수를 추정하고자 할 때는 지수 모형, 베이불 모형 등의 모형을 사용한다**

    **Cox 회귀분석을 하면 각각의 변수가 기준선 위험에 비해 얼마나 더 위험을 높이거나 낮추는지 위험비를 알 수 있다**

    위험비가 높아지만 생존함수의 곡선도 높아진다 

    → 낮아짐 (밑으로)/ 위험비가 낮으면 생존함수의 곡선이 올라감 

# 아르바이트

- 강의 자료 개발
    - 강의 내용 미리 듣고, 강의 대본 및 슬라이드 작성
    - 듣고 싶은 강의를 소수 정예로 들을 수 있음
    - 꼼꼼하고 정리를 잘하시는 분께 추천
- 로맨스 소설 DB 구축
    - 로맨스 소설 장면 단위 db 구축
    - 재미있는(?) 업무
    - 로맨스 소설을 좋아하고, 상상력이 풍부한 분께 추천